[tools]
python = "3.13"
node = '24.3.0'
watchexec = "latest"

[env]
_.python.venv = { path = ".venv", create = true }
PYTHONIOENCODING = "utf-8"

[hooks]
postinstall = "python -m pip install -r requirements.txt"

[tasks.host-ip]
run = """python -c "import socket; print(socket.gethostbyname(socket.gethostname()))" """

[tasks.chords]
run = "python -m src.chords"

[tasks.serve]
run = "npx -y live-server"

[tasks.test-pytest]
run = "python -m pytest --log-cli-level=WARN -rA -vv --json-report=report_output/final_report.json -capture-screenshots=none --should-open-report=never && mv plus_metadata.json report_output/plus_metadata.json"

[tasks.test-pytest-watch]
run = "mise watch test-pytest"

[tasks.test-index]
run = ["mkdir report_output", """ echo "<html><head><meta http-equiv='refresh' content='0; url=report.html'/>" > report_output/index.html"""]

[tasks.test-livereload]
run = "mise exec -- livereload --host 0.0.0.0 report_output"

[tasks.test]
run = "mise run test-index ::: test-livereload ::: test-pytest-watch"
